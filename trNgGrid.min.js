var TrNgGrid;(function(n){var t;(function(n){n.tableDirective="trNgGrid";n.tableDirectiveAttribute="data-tr-ng-grid";n.dataColumnIsAutoGeneratedAttribute=n.tableDirectiveAttribute+"-auto-generated";n.dataColumnIsAutoGeneratedField=n.tableDirective+"AutoGenerated";n.dataColumnIsCustomizedAttribute=n.tableDirectiveAttribute+"-customized";n.dataColumnIsCustomizedField=n.tableDirective+"Customized";n.sortFilter=n.tableDirective+"SortFilter";n.dataPagingFilter=n.tableDirective+"DataPagingFilter";n.translateFilter=n.tableDirective+"TranslateFilter";n.dataFormattingFilter=n.tableDirective+"DataFormatFilter";n.defaultTranslationLocale="default";n.bodyDirective=n.tableDirective+"Body";n.bodyDirectiveAttribute=n.tableDirectiveAttribute+"-body";n.bodyRowDirective=n.bodyDirective+"Row";n.bodyRowDirectiveAttribute=n.bodyDirectiveAttribute+"-row";n.headerDirective=n.tableDirective+"Header";n.headerDirectiveAttribute=n.tableDirectiveAttribute+"-header";n.headerRowDirective=n.headerDirective+"Row";n.headerRowDirectiveAttribute=n.headerDirectiveAttribute+"-row";n.footerDirective=n.tableDirective+"Footer";n.footerDirectiveAttribute=n.tableDirectiveAttribute+"-footer";n.globalFilterDirective=n.tableDirective+"GlobalFilter";n.globalFilterDirectiveAttribute=n.tableDirectiveAttribute+"-global-filter";n.pagerDirective=n.tableDirective+"Pager";n.pagerDirectiveAttribute=n.tableDirectiveAttribute+"-pager";n.headerCellDirective=n.tableDirective+"HeaderCell";n.headerCellDirectiveAttribute=n.tableDirectiveAttribute+"-header-cell";n.headerCellPlaceholderDirective=n.headerCellDirective+"Placeholder";n.headerCellPlaceholderDirectiveAttribute=n.headerCellDirectiveAttribute+"-placeholder";n.headerCellDirective=n.tableDirective+"HeaderCell";n.headerCellDirectiveAttribute=n.tableDirectiveAttribute+"-header-cell";n.bodyCellDirective=n.tableDirective+"BodyCell";n.bodyCellDirectiveAttribute=n.tableDirectiveAttribute+"-body-cell";n.footerCellDirective=n.tableDirective+"FooterCell";n.footerCellDirectiveAttribute=n.tableDirectiveAttribute+"-footer-cell";n.columnSortDirective=n.tableDirective+"ColumnSort";n.columnSortDirectiveAttribute=n.tableDirectiveAttribute+"-column-sort";n.columnFilterDirective=n.tableDirective+"ColumnFilter";n.columnFilterDirectiveAttribute=n.tableDirectiveAttribute+"-column-filter";n.gridConfigurationService=n.tableDirective+"Configuration";n.gridConfigurationProvider=n.gridConfigurationService+"Provider"})(t=n.Constants||(n.Constants={}))})(TrNgGrid||(TrNgGrid={})),function(n){function t(n,t){var r,i,u;for(t=t.toUpperCase(),r=n.children(),i=0;i<r.length;i++)if(u=r[i],u.tagName===t)return angular.element(u);return null}function s(n){for(var r=n.parent(),i=r.children(),t=0;t<i.length&&i[t]===n[0];t++);return t>=i.length?-1:t}function i(n,t){var r,u,i,f;for(t=t.toUpperCase(),r=[],u=n.children(),i=0;i<u.length;i++)f=u[i],f.tagName===t&&r.push(angular.element(f));return r}function h(n,t){var i=n.children(),r;i.length===1&&angular.element(i[0]).attr(t)||(r=angular.element("<div>"+n.html()+"<\/div>").attr(t,""),n.empty(),n.append(r))}function c(n){var t=[];for(var i in n)t.push(i);return t}function r(t){console.log(n.Constants.tableDirective+"("+(new Date).getTime()+"): "+t)}function u(){return t(t(angular.element("<table><tbody><tr><\/tr><\/tbody><\/table>"),"tbody"),"tr")}function f(n){return t(t(t(angular.element("<table><tbody><tr><"+n+"><\/"+n+"><\/tr><\/tbody><\/table>"),"tbody"),"tr"),n)}function e(t,i,r,u){var e,o,s;return i||(i=f(r),i.attr(n.Constants.dataColumnIsAutoGeneratedAttribute,"true")),i.attr(u,""),e=i.children(),o=e.length||i.html().replace(/^\s+|\s+$/gm,""),o&&e.length===0&&(s=angular.element("<div>"+i.html()+"<\/div>"),i.empty(),i.append(s)),o&&i.attr(n.Constants.dataColumnIsCustomizedAttribute,"true"),i}function o(t,r,f,o,s){var h,a=i(r,"tr"),v,c,l,y,p;for(a.length||(r.empty(),h=u(),r.append(h),a.push(h)),v=0;v<a.length;v++)for(h=a[v],h.attr(f,""),c=i(h,o),c.length!==0&&c[0].attr(n.Constants.headerCellPlaceholderDirectiveAttribute)||(l=angular.element(t.templates.headerCellStandard),l.attr("data-ng-repeat","gridColumnLayout in (gridLayoutRow.cells)"),l.attr("data-ng-if","!gridColumnLayout.isDeactivated"),l.attr(n.Constants.headerCellPlaceholderDirectiveAttribute,""),h.prepend(l)),y=0;y<c.length;y++)p=c[y],e(t,p,o,s)}function l(i,u){var f=t(u,"thead"),e,s;f||(f=t(angular.element("<table><thead><\/thead><\/table"),"thead"),u.prepend(f));f.attr(n.Constants.headerDirectiveAttribute,"");o(i,f,n.Constants.headerRowDirectiveAttribute,"th",n.Constants.headerCellDirectiveAttribute);e=t(u,"tfoot");e||(e=t(angular.element("<table><tfoot><\/tfoot><\/table"),"tfoot"),f.after(e));s=t(u,"tbody");s||(s=t(angular.element("<table><tbody><\/tbody><\/table"),"tbody"),e.after(s));angular.forEach(u.children,function(n){(n!==f[0]||n!==s[0]||n!==e[0])&&(angular.element(n).remove(),i.debugMode&&r("Invalid extra element found inside the grid template structure: "+n.tagName))})}n.findChildByTagName=t;n.findChildIndex=s;n.findChildrenByTagName=i;n.wrapTemplatedCell=h;n.extractFields=c;n.log=r;n.createRowElement=u;n.createCellElement=f;n.fixGridCell=e;n.fixGridSection=o;n.fixTableStructure=l}(TrNgGrid||(TrNgGrid={})),function(n){var t,r,i;(function(n){n[n.None=0]="None";n[n.SingleRow=1]="SingleRow";n[n.MultiRow=2]="MultiRow";n[n.MultiRowWithKeyModifiers=3]="MultiRowWithKeyModifiers"})(n.SelectionMode||(n.SelectionMode={}));t=n.SelectionMode;r=function(){function n(){}return n}();n.IGridRow=r;i=function(){function i(n,t,i,r){this.$compile=n;this.$parse=t;this.$timeout=i;this.gridConfiguration=r;this.nonFieldNameTagIndex=0;this.nonFieldNameFormat="$$_trNgGridCustom_";this.gridColumns={}}return i.prototype.setGridOptions=function(i){var r=this,u,f;this.gridOptions=i;this.gridLayout=new n.GridLayout(this.gridConfiguration,this.gridOptions);this.gridOptions.onDataRequired&&(u=function(){r.dataRequestPromise=null;r.gridOptions.immediateDataRetrieval=!1;r.gridOptions.onDataRequired(r.gridOptions)},f=function(){r.dataRequestPromise&&(r.$timeout.cancel(r.dataRequestPromise),r.dataRequestPromise=null);r.gridOptions.immediateDataRetrieval?u():r.dataRequestPromise=r.$timeout(function(){u()},r.gridOptions.onDataRequiredDelay,!0)},this.gridOptions.$watch("currentPage",function(n,t){n!==t&&f()}),this.gridOptions.$watchCollection("[filterBy, filterByFields, orderBy, orderByReverse, pageItems, ]",function(){if(r.gridOptions.currentPage!==0){r.gridOptions.currentPage=0;return}f()}),this.gridOptions.$watch("immediateDataRetrieval",function(n){n&&r.dataRequestPromise&&(r.$timeout.cancel(r.dataRequestPromise),u())}));this.gridOptions.$watch("selectionMode",function(n,i){if(n!==i)switch(n){case t[0]:r.gridOptions.selectedItems.splice(0);break;case t[1]:r.gridOptions.selectedItems.length>1&&r.gridOptions.selectedItems.splice(1)}})},i.prototype.setColumnOptions=function(n){if(n.isLinkedToField=!!n.fieldName||n.fieldName.indexOf(this.nonFieldNameFormat)<0,n.fieldName||(n.fieldName=this.nonFieldNameFormat+this.nonFieldNameTagIndex++),n.displayItemFieldName=n.fieldName.replace(/[^a-zA-Z]/g,"_"),n.displayName)n.columnTitle=n.displayName;else if(n.isLinkedToField){var i=n.fieldName.replace(/^([^\a-zA-Z]*)([\a-zA-Z]*)(.*)/g,"$2"),t=i.split(/(?=[A-Z])/);t.length&&t[0].length&&(t[0]=t[0][0].toLocaleUpperCase()+t[0].substr(1));n.columnTitle=t.join(" ")}else n.columnTitle="";return this.gridColumns[n.fieldName]=angular.extend(this.gridColumns[n.fieldName]||{},this.gridConfiguration.defaultColumnOptions,n)},i.prototype.getColumnOptions=function(n){return this.gridColumns[n]},i.prototype.speedUpAsyncDataRetrieval=function(n){n&&n.keyCode!=13||(this.gridOptions.immediateDataRetrieval=!0)},i.prototype.toggleSorting=function(n){this.gridOptions.orderBy!=n?this.gridOptions.orderBy=n:this.gridOptions.orderByReverse=!this.gridOptions.orderByReverse;this.speedUpAsyncDataRetrieval()},i.prototype.getFormattedFieldName=function(){},i.prototype.setFilter=function(){},i.prototype.toggleItemSelection=function(n,i,r){var h,f,c,e,l,o,s,u;if(this.gridOptions.selectionMode!==t[0])switch(this.gridOptions.selectionMode){case t[3]:if(r.ctrlKey||r.shiftKey||r.metaKey){if(r.ctrlKey||r.metaKey)u=this.gridOptions.selectedItems.indexOf(i),u>=0?this.gridOptions.selectedItems.splice(u,1):this.gridOptions.selectedItems.push(i);else if(r.shiftKey){for(document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&(h=window.getSelection(),h.removeAllRanges()),c=this.gridOptions.selectedItems[this.gridOptions.selectedItems.length-1],f=0;f<n.length&&n[f].$$_gridItem!==c;f++);for(f>=n.length&&(f=0),e=0;e<n.length&&n[e].$$_gridItem!==i;e++);if(e>=n.length)throw"Invalid selection on a key modifier selection mode";for(e<f&&(l=f,f=e,e=l),o=f;o<=e;o++)s=n[o].$$_gridItem,this.gridOptions.selectedItems.indexOf(s)<0&&this.gridOptions.selectedItems.push(s)}}else u=this.gridOptions.selectedItems.indexOf(i),this.gridOptions.selectedItems.splice(0),u<0&&this.gridOptions.selectedItems.push(i);break;case t[1]:u=this.gridOptions.selectedItems.indexOf(i);this.gridOptions.selectedItems.splice(0);u<0&&this.gridOptions.selectedItems.push(i);break;case t[2]:u=this.gridOptions.selectedItems.indexOf(i);u>=0?this.gridOptions.selectedItems.splice(u,1):this.gridOptions.selectedItems.push(i)}},i.prototype.computeFormattedItems=function(){},i.prototype.computeFilteredItems=function(){},i.prototype.setupDisplayItemsArray=function(){},i}();n.GridController=i;n.gridModule=angular.module(n.Constants.tableDirective,[]);n.gridModule.directive(n.Constants.tableDirective,[n.Constants.gridConfigurationService,function(t){return{restrict:"A",scope:{items:"=",selectedItems:"=?",filterBy:"=?",filterByFields:"=?",orderBy:"=?",orderByReverse:"=?",pageItems:"=?",currentPage:"=?",totalItems:"=?",enableFiltering:"=?",enableSorting:"=?",selectionMode:"@",locale:"@",onDataRequired:"&",onDataRequiredDelay:"=?",fields:"=?"},controller:["$compile","$parse","$timeout",n.Constants.gridConfigurationService,i],compile:function(i){return n.fixTableStructure(t,i),{pre:function(n,t,i,r){r.setGridOptions(n)}}}}}])}(TrNgGrid||(TrNgGrid={})),function(n){var r=function(){function n(){this.minifiedPageCountThreshold=3}return n}(),u=function(){function n(){this.tableCssClass="tr-ng-grid table table-bordered table-hover ";this.cellCssClass="tr-ng-cell ";this.headerCellCssClass="tr-ng-cell tr-ng-column-header ";this.bodyCellCssClass="tr-ng-cell ";this.columnTitleCssClass="tr-ng-title ";this.columnSortCssClass="tr-ng-sort pull-right pull-top ";this.columnFilterInputWrapperCssClass=" ";this.columnFilterCssClass="tr-ng-column-filter ";this.columnSortActiveCssClass="tr-ng-sort-active text-info ";this.columnSortInactiveCssClass="tr-ng-sort-inactive text-muted glyphicon glyphicon-chevron-down ";this.columnSortReverseOrderCssClass="tr-ng-sort-order-reverse glyphicon glyphicon-chevron-down ";this.columnSortNormalOrderCssClass="tr-ng-sort-order-normal glyphicon glyphicon-chevron-up ";this.rowSelectedCssClass="active ";this.footerCssClass="tr-ng-grid-footer form-inline "}return n}(),t=function(){function n(){this.cellWidth=undefined;this.cellHeight=undefined;this.displayAlign="left";this.displayFormat=undefined;this.displayName=undefined;this.filter=undefined;this.enableFiltering=!0;this.enableSorting=!0}return n}(),i,f;n.GridConfigurationDefaultColumnOptions=t;i=function(){function t(t,i){var r=t.startSymbol(),u=t.endSymbol();this.headerCellStandard="<th><\/th>";this.headerCellContentsStandard='<div class="'+i.headerCellCssClass+'" >  <div '+n.Constants.columnSortDirectiveAttribute+'=""><\/div>  <a '+i.columnTitleCssClass+'"     href="" ng-click="((gridOptions.enableSorting&&gridColumnOptions.enableSorting!==false)||gridColumnOptions.enableSorting)&&toggleSorting(gridColumnOptions.fieldName)">      '+r+"gridColumnOptions.columnTitle |"+n.Constants.translateFilter+":gridOptions.locale"+u+"  <\/a>  <div "+n.Constants.columnFilterDirectiveAttribute+'=""><\/div><\/div>';this.bodyCellStandard='<div ng-attr-class="'+i.bodyCellCssClass+' text-{{columnOptions.displayAlign}}" ng-switch="isCustomized">  <div ng-switch-when="true">    <div ng-transclude=""><\/div>  <\/div>  <div ng-switch-default>{{gridDisplayItem[columnOptions.displayFieldName]}}<\/div><\/div>';this.footerCellStandard='<div class="'+i.footerCssClass+'" ng-switch="isCustomized">  <div ng-switch-when="true">    <div ng-transclude=""><\/div>  <\/div>  <div ng-switch-default>    <span '+n.Constants.globalFilterDirectiveAttribute+'=""><\/span>    <span '+n.Constants.pagerDirectiveAttribute+'=""><\/span>  <\/div><\/div>';this.columnFilter='<div ng-show="(gridOptions.enableFiltering&&columnOptions.enableFiltering!==false)||columnOptions.enableFiltering" class="'+i.columnFilterCssClass+'"> <div class="'+i.columnFilterInputWrapperCssClass+'">   <input class="form-control input-sm" type="text" ng-model="columnOptions.filter" ng-keypress="speedUpAsyncDataRetrieval($event)"><\/input> <\/div><\/div>';this.columnSort='<a href="" ng-attr-title="{{\'Sort\'|'+n.Constants.translateFilter+':gridOptions.locale}}" ng-show="(gridOptions.enableSorting&&columnOptions.enableSorting!==false)||columnOptions.enableSorting" ng-click="toggleSorting(columnOptions.fieldName)" class="'+i.columnSortCssClass+'" >   <span ng-class="{\''+i.columnSortActiveCssClass+"':gridOptions.orderBy==columnOptions.fieldName,'"+i.columnSortInactiveCssClass+"':gridOptions.orderBy!=columnOptions.fieldName,'"+i.columnSortNormalOrderCssClass+"':gridOptions.orderBy==columnOptions.fieldName&&!gridOptions.orderByReverse,'"+i.columnSortReverseOrderCssClass+"':gridOptions.orderBy==columnOptions.fieldName&&gridOptions.orderByReverse}\" >  <\/span><\/a>";this.footerGlobalFilter='<span ng-show="gridOptions.enableFiltering" class="pull-left form-group">  <input class="form-control" type="text" ng-model="gridOptions.filterBy" ng-keypress="speedUpAsyncDataRetrieval($event)" ng-attr-placeholder="{{\'Search\'|'+n.Constants.translateFilter+':gridOptions.locale}}"><\/input><\/span>';this.footerPager='<span class="pull-right form-group"> <ul class="pagination">   <li ng-class="{disabled:gridOptions.currentPage==0}" ng-if="isPaged&&!pageRangeFullCoverage">     <a href="" ng-click="gridOptions.currentPage!=0&&navigateToPage(0)" ng-attr-title="{{\'First Page\'|'+n.Constants.translateFilter+':gridOptions.locale}}">         <span>&laquo;<\/span>     <\/a>   <\/li>   <li ng-class="{disabled:gridOptions.currentPage==0}" ng-if="isPaged&&!pageRangeFullCoverage">     <a href="" ng-click="gridOptions.currentPage!=0&&navigateToPage(gridOptions.currentPage - 1)" ng-attr-title="{{\'Previous Page\'|'+n.Constants.translateFilter+':gridOptions.locale}}">         <span>&lsaquo;<\/span>     <\/a>   <\/li>   <li ng-if="isPaged&&!pageRangeFullCoverage&&visiblePageRange[0]!=0"class="disabled">      <span>...<\/span>   <\/li>   <li ng-if="isPaged" ng-repeat="pageIndex in visiblePageRange track by $index" ng-class="{active:pageIndex===gridOptions.currentPage}">      <a href="" ng-click="navigateToPage(pageIndex)" ng-attr-title="{{\'Page\'|'+n.Constants.translateFilter+':gridOptions.locale}}">{{pageIndex+1}}<\/a>   <\/li>   <li ng-if="isPaged&&!pageRangeFullCoverage&&visiblePageRange[visiblePageRange.length-1]!=lastPage" class="disabled">      <span>...<\/span>   <\/li>   <li ng-class="{disabled:gridOptions.currentPage==lastPage}" ng-if="isPaged&&!pageRangeFullCoverage">     <a href="" ng-click="gridOptions.currentPage!=lastPage&&navigateToPage(gridOptions.currentPage + 1)" ng-attr-title="{{\'Next Page\'|'+n.Constants.translateFilter+':gridOptions.locale}}">         <span>&rsaquo;<\/span>     <\/a>   <\/li>   <li ng-class="{disabled:gridOptions.currentPage==lastPage}" ng-if="isPaged&&!pageRangeFullCoverage">     <a href="" ng-click="gridOptions.currentPage!=lastPage&&navigateToPage(lastPage)" ng-attr-title="{{\'Last Page\'|'+n.Constants.translateFilter+':gridOptions.locale}}">         <span>&raquo;<\/span>     <\/a>   <\/li>   <li class="disabled" style="white-space: nowrap;">     <span ng-hide="totalItemsCount">{{\'No items to display\'|'+n.Constants.translateFilter+":gridOptions.locale}}<\/span>     <span ng-show=\"totalItemsCount\">       {{visibleStartItemIndex+1}} - {{visibleEndItemIndex+1}} {{'displayed'|"+n.Constants.translateFilter+":gridOptions.locale}}       <span>, {{totalItemsCount}} {{'in total'|"+n.Constants.translateFilter+":gridOptions.locale}}<\/span>     <\/span >    <\/li> <\/ul><\/span>"}return t}();f=function(){function f(n){var t=this;this.$interpolateProvider=n;this.$get=[function(){return{styles:t.styles(),defaultColumnOptions:t.defaultColumnOptions(),translations:t.gridTranslations,pagerOptions:t.pagerOptions(),templates:t.templates(),debugMode:t.debugMode()}}];this.gridTranslations={};this.gridDebugMode=!0}return f.prototype.styles=function(n){return n&&(this.gridStyles=angular.extend({},new u,n)),angular.extend({},this.gridStyles||new u)},f.prototype.defaultColumnOptions=function(n){return n&&(this.gridDefaultColumnOptions=angular.extend({},new t,n)),angular.extend({},this.gridDefaultColumnOptions||new t)},f.prototype.translations=function(n,t){var i=this.gridTranslations[n]=angular.extend({},this.gridTranslations[n],t);return angular.extend({},i)},f.prototype.defaultTranslations=function(t){return this.translations(n.Constants.defaultTranslationLocale,t)},f.prototype.pagerOptions=function(n){return n&&(this.gridPagerOptions=angular.extend({},new r,n)),angular.extend({},this.gridPagerOptions||new r)},f.prototype.templates=function(n){return n&&(this.gridTemplates=angular.extend({},new i(this.$interpolateProvider,this.styles()),n)),angular.extend({},this.gridTemplates||new i(this.$interpolateProvider,this.styles()))},f.prototype.debugMode=function(n){return n!==undefined&&(this.gridDebugMode=!!n),this.gridDebugMode},f}();n.gridModule.provider(n.Constants.gridConfigurationService,f)}(TrNgGrid||(TrNgGrid={})),function(n){var f,t,i,r,u;(function(n){n[n.Enforced=0]="Enforced";n[n.Header=1]="Header";n[n.Body=2]="Body"})(n.GridSectionType||(n.GridSectionType={}));f=n.GridSectionType;t=function(){function n(){this.fieldName=undefined;this.colspan=undefined;this.isCustomized=undefined;this.isAutoGenerated=undefined;this.isLinkedToField=undefined;this.isDeactivated=undefined;this.placeholder=undefined}return n}();n.DefaultGridColumnLayoutOptions=t;i=function(){function t(n,t,i){this.gridConfiguration=n;this.gridLayout=t;this.gridSectionType=i;this.cells=[]}return t.prototype.findCell=function(n){for(var t=0;t<this.cells.length;t++)if(this.cells[t].fieldName===n)return this.cells[t];return null},t.prototype.registerCell=function(t,i){var u,r;if(!t.fieldName)throw"A field name was not provided";if(u=!1,i===undefined)for(r=0;r<this.cells.length&&!u;r++)this.cells[r].fieldName===t.fieldName&&(this.cells[r]=t,this.gridConfiguration.debugMode&&n.log("A layout cell ["+t.fieldName+"] was updated in section "+this.gridSectionType),u=!0);u||(i===undefined||i===this.cells.length?this.cells.push(t):this.cells.splice(i,0,t),this.gridConfiguration.debugMode&&n.log("A new layout cell ["+t.fieldName+"] was registered in section "+this.gridSectionType));this.gridLayout.triggerReconciliation()},t.prototype.unregisterCell=function(t){for(var i=0;i<this.cells.length;i++)if(this.cells[i]===t){this.cells.splice(i,1);this.gridConfiguration.debugMode&&n.log("A layout cell ["+t.fieldName+"] was unregistered in section "+this.gridSectionType);this.gridLayout.triggerReconciliation();return}},t}();n.GridLayoutRow=i;r=function(){function t(n,t,i){this.gridConfiguration=n;this.gridLayout=t;this.gridSectionType=i;this.rows=[]}return t.prototype.registerRow=function(){var t=new i(this.gridConfiguration,this.gridLayout,this.gridSectionType);return this.rows.push(t),this.gridConfiguration.debugMode&&n.log("A new layout row ["+this.rows.length+"] was registered in section "+this.gridSectionType),this.gridLayout.triggerReconciliation(),t},t.prototype.unregisterRow=function(t){for(var i=0;i<this.rows.length;i++)if(this.rows[i]===t){this.rows.splice(i,1);this.gridConfiguration.debugMode&&n.log("A layout row was unregistered in section "+this.gridSectionType);this.gridLayout.triggerReconciliation();return}},t.prototype.clear=function(){this.rows.splice(0);this.gridConfiguration.debugMode&&n.log("Layout section "+this.gridSectionType+" got cleared");this.gridLayout.triggerReconciliation()},t}();n.GridLayoutSection=r;u=function(){function i(n,t){this.gridConfiguration=n;this.gridOptions=t;this.sections=new Array(3);this.reconciliationTriggerKey="triggerGridReconciliation";this.reconciling=!1;this.setupListeners()}return i.prototype.getSection=function(t){var i=this.sections[t];return i||(this.sections[t]=i=new r(this.gridConfiguration,this,t),this.gridConfiguration.debugMode&&n.log("A new layout section ["+t+"] was registered"),this.triggerReconciliation()),i},i.prototype.triggerReconciliation=function(){this.gridOptions[this.reconciliationTriggerKey]=!0},i.prototype.setupListeners=function(){var i=this,t;this.gridOptions.$watch(this.reconciliationTriggerKey,function(n){n&&i.reconcile()});t=null;t=this.gridOptions.$watch("items.length",function(r){r&&(i.enforceFields(n.extractFields(i.gridOptions.items[0])),t&&(t(),t=null))});this.gridOptions.fields&&(this.enforceFields(this.gridOptions.fields),t&&(t(),t=null));this.gridOptions.$watchCollection("fields",function(n,r){angular.equals(n,r)||(i.enforceFields(n||[]),t&&(t(),t=null))})},i.prototype.enforceFields=function(n){var i=this.getSection(0),r;n?(i.clear(),r=i.registerRow(),angular.forEach(n,function(n){var i=new t;i.fieldName=n;i.isAutoGenerated=!0;i.isLinkedToField=!0;r.registerCell(i)})):i.clear()},i.prototype.reconcile=function(){var u=this,r,n,t,i;try{for(r=[],n=0;n<=1&&r.length===0;n++)angular.forEach(this.getSection(n).rows,function(n){angular.forEach(n.cells,function(n){n.isLinkedToField&&r.push(n.fieldName)})});for(t=[],n=0;n<=2;n++)angular.forEach(this.getSection(n).rows,function(i){n!==0&&u.cleanupRowForReconciliation(i,r);t.push(i)});for(i=0;i<t.length-1;i++)this.reconcileRows(t[i],t[i+1])}finally{this.gridOptions[this.reconciliationTriggerKey]=!1}},i.prototype.reconcileRows=function(n,t){for(var u,o,i,f,r=0,e=0;e<n.cells.length;e++)if(u=n.cells[e],!u.isDeactivated)for(o=!0;o;)i=r<t.cells.length?t.cells[r]:null,i&&i.isDeactivated||((!i||i.isLinkedToField!==u.isLinkedToField||i.isLinkedToField&&i.fieldName!==u.fieldName)&&(i=angular.extend({},u),i.isAutoGenerated=!0,i.isCustomized=!1,t.registerCell(i,r)),o=!1),r++;while(r<t.cells.length)f=t.cells[r],f.isAutoGenerated?t.unregisterCell(f):(f.isDeactivated=!0,r++)},i.prototype.cleanupRowForReconciliation=function(n,t){for(var i,r=0;r<n.cells.length;r++)i=n.cells[r],i.isAutoGenerated?(n.unregisterCell(i),r--):i.isDeactivated=i.isLinkedToField&&t.indexOf(i.fieldName)<0},i}();n.GridLayout=u;var e=n.extractFields(new n.GridConfigurationDefaultColumnOptions),o=n.extractFields(new t),s=function(){function n(n){this.$scope=n}return n.prototype.prepareColumn=function(){var n=this,t=this.$scope.$parent;this.gridController=t.grid;this.gridLayoutRow=t.gridLayoutRow;this.columnScope=t.$new();this.$scope.$on("$destroy",function(){n.columnScope.$destroy();n.columnScope=null});this.$scope.$watchGroup(e,function(){n.registerColumnOptions()});this.$scope.$watchGroup(o,function(){n.registerColumnLayoutOptions()});this.registerColumnOptions();this.registerColumnLayoutOptions()},n.prototype.registerColumnOptions=function(){var n={fieldName:this.$scope.fieldName,displayName:this.$scope.displayName,displayAlign:this.$scope.displayAlign,displayFormat:this.$scope.displayFormat,enableSorting:this.$scope.enableSorting===undefined?undefined:this.$scope.enableSorting.toString()==="true",enableFiltering:this.$scope.enableFiltering===undefined?undefined:this.$scope.enableFiltering.toString()==="true",cellWidth:this.$scope.cellWidth,cellHeight:this.$scope.cellHeight,filter:this.$scope.filter};n=this.gridController.setColumnOptions(n);this.columnOptions=n;this.columnScope.gridColumnOptions=this.columnOptions},n.prototype.registerColumnLayoutOptions=function(){this.columnOptions||this.registerColumnOptions();var n={fieldName:this.$scope.fieldName,isAutoGenerated:this.$scope.isAutoGenerated&&this.$scope.isAutoGenerated.toString()==="true",isCustomized:this.$scope.isCustomized&&this.$scope.isCustomized.toString()==="true",isLinkedToField:this.columnOptions.isLinkedToField};n.isAutoGenerated?n=this.gridLayoutRow.findCell(n.fieldName):this.gridLayoutRow.registerCell(n);this.columnLayout=n;this.columnScope.gridColumnLayout=this.columnLayout},n}();n.GridColumnSetupController=s}(TrNgGrid||(TrNgGrid={})),function(n){n.gridModule.directive(n.Constants.headerDirective,[function(){return{restrict:"A",scope:!0,require:"^"+n.Constants.tableDirective,link:{pre:function(t,i,r,u){t.grid=u;t.gridOptions=u.gridOptions;t.gridLayoutSection=u.gridLayout.getSection(n.GridSectionType.Header)}}}}]);n.gridModule.directive(n.Constants.headerRowDirective,["$compile",n.Constants.gridConfigurationService,function(){return{restrict:"A",scope:!0,require:"^"+n.Constants.tableDirective,compile:function(){return{pre:function(n){n.gridLayoutRow=n.gridLayoutSection.registerRow();n.$on("$destroy",function(){n.gridLayoutSection.unregisterRow(n.gridLayoutRow)})},post:function(){}}}}}]);n.gridModule.directive(n.Constants.headerCellPlaceholderDirective,["$compile","$interpolate",n.Constants.gridConfigurationService,function(t,i,r){var u=angular.element(r.templates.headerCellStandard);return u.attr(n.Constants.headerCellDirectiveAttribute,""),u.attr(n.Constants.dataColumnIsAutoGeneratedAttribute,"true"),u.attr("data-field-name",i.startSymbol()+"gridColumnLayout.fieldName"+i.endSymbol()),{restrict:"A",require:"^"+n.Constants.tableDirective,transclude:"element",scope:!0,compile:function(){return{pre:function(n,t){n.gridColumnLayout.placeholder=t},post:function(n,i){var r,e,f;n.gridColumnLayout.isAutoGenerated&&(r=u.clone(),i.after(r),e=t(r),f=e(n),n.$on("$destroy",function(){f&&(f.remove(),f=null);r&&(r.remove(),r=null)}))}}}}}]);n.gridModule.directive(n.Constants.headerCellDirective,["$compile",n.Constants.gridConfigurationService,function(t,i){return{restrict:"A",require:"^"+n.Constants.tableDirective,controller:["$scope","$controller",n.GridColumnSetupController],scope:{isCustomized:"@"+n.Constants.dataColumnIsCustomizedField,isAutoGenerated:"@"+n.Constants.dataColumnIsAutoGeneratedField,fieldName:"@",displayName:"@",displayAlign:"@",displayFormat:"@",enableSorting:"@",enableFiltering:"@",cellWidth:"@",cellHeight:"@",filter:"@",colspan:"@"},priority:101,controllerAs:"gridColumnSetup",transclude:"element",terminal:!0,compile:function(){return{pre:function(){},post:function(n,r,u,f,e){n.gridColumnSetup.prepareColumn();var o=null,s=function(){o&&(o.remove(),o=null);var r=n.gridColumnSetup.columnScope,u=r.gridColumnLayout;u.placeholder&&e(r,function(n){if(o=n,u.placeholder.after(o),!u.isCustomized){var f=angular.element(i.templates.headerCellContentsStandard);o.append(f);t(f)(r)}})};n.$watch("gridColumnSetup.columnScope.gridColumnLayout.placeholder",function(n,t){n!==t&&s()});s()}}}}}])}(TrNgGrid||(TrNgGrid={})),function(n){n.gridModule.filter(n.Constants.sortFilter,["$filter","$parse",function(n,t){return function(i,r,u){if(!r.orderBy||!u)return i;return n("orderBy")(i,function(n){var i=undefined;try{i=t("item.trNgGridDataItem."+r.orderBy)({item:n})}catch(f){}if(i===undefined)try{i=t("item."+u.displayFieldName)({item:n})}catch(f){}return i},r.orderByReverse)}}]).filter(n.Constants.dataPagingFilter,function(){return function(n,t){var i,r;return(n&&(t.totalItems=n.length),!t.pageItems||!n||n.length===0)?n:(t.currentPage||(t.currentPage=0),i=t.currentPage*t.pageItems,i>=n.length&&(t.currentPage=0,i=0),r=t.currentPage*t.pageItems+t.pageItems,n.slice(i,r))}}).filter(n.Constants.translateFilter,["$filter","$injector",n.Constants.gridConfigurationService,function(t,i,r){function u(t,i){for(var s,e,f=null,o=t.split(/[-_]/),u=o.length;u>=0&&!f;u--)s=u===0?n.Constants.defaultTranslationLocale:o.slice(0,u).join("-"),e=r.translations[s],e&&(f=i(e));return f}return function(r,f){var e,o;if(!r)return r;if(f||(f=n.Constants.defaultTranslationLocale),r instanceof Date)return o=u(f,function(n){return n.localeDateFormat}),t("date")(r,o);if(e=u(f,function(n){return n[r]}),!e&&i.has("translateFilter"))try{e=t("translate")(r)}catch(s){}return e||(e=r),e}}])}(TrNgGrid||(TrNgGrid={}));